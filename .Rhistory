y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: Basketball-Reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray40') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none')
# chart
ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: Basketball-Reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray10') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none')
# chart
ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: Basketball-Reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray90') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none')
# chart
ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: Basketball-Reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none')
# chart
ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_bar(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: Basketball-Reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none')
# chart
ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_col(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: Basketball-Reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none')
# chart
ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: Basketball-Reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none')
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250GSW")
117-94
gg
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250GSW")
gg
4.15 * 60
12 * 60
720 + 720 + 250
gg + geom_vline(xintercept = 1690)
gg + geom_vline(xintercept = 1690) + annotate(x=1600,y=-30,label="LeBron Out")
gg + geom_vline(xintercept = 1690) + annotate('text',x=1600,y=-30,label="LeBron Out")
gg + geom_vline(xintercept = 1690) + annotate('text',x=1650,y=-30,label="LeBron Out",angl=90)
gg + geom_vline(xintercept = 1690) + annotate('text',x=1650,y=-30,label="LeBron Out",angle=90)
gg + geom_vline(xintercept = 1690) + annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hadjust=0)
gg + geom_vline(xintercept = 1690) + annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0)
gg + geom_vline(xintercept = 1690) + annotate('text',x=1600,y=-30,label="LeBron Out",angle=90,hjust=0)
4*60
+10
720*2
1440 + 250
# chart
gg <<- ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: basketball-reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none') +
geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0)
preview(gg)
ifelse(periods <= 4, paste0("Q", periods),
paste0("OT", periods - 4))
x_label <- paste0(ifelse(periods <= 4, paste0("Q", periods),
paste0("OT", periods - 4)),"→")
# chart
gg <<- ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: basketball-reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none') +
geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0)
preview(gg)
ifelse(periods <= 4, 12 * 60 * periods,
12 * 60 * 4 + 5 * 60 * (periods - 4))
x_label <- paste0("←",ifelse(periods <= 4, paste0("Q", periods),
paste0("OT", periods - 4)))
# chart
gg <<- ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: basketball-reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none') +
geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0)
preview(gg)
x_label <- paste0("←",ifelse(periods <= 4, paste0("Q", periods),
paste0("OT", periods - 4)),"   ")
# chart
gg <<- ggplot(pbp, aes(x=time,y=home_adv)) +
geom_hline(yintercept=0,linetype=2,col='gray40') +
geom_step(aes(col=home_adv>0,group=1)) +
labs(title = sprintf("%s @ %s, %s",
meta$visitor_team_name, meta$home_team_name,
format.Date(meta$date_game,"%b. %d '%y")),
x = "",
y = sprintf("%s Score Margin",meta$home_team_name),
caption="Source: basketball-reference.com") +
scale_x_continuous(breaks = x_value, labels = x_label) +
geom_vline(xintercept = x_value,linetype=2,col='gray70') +
#annotate('text',x = x_value-100,y=min(pbp$home_adv),label=x_label) +
theme_elliott() +
theme(panel.spacing = unit(0,"lines"),
legend.position = 'none') +
geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0)
preview(gg)
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250GSW")
gg  +
geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0)
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2700) +
annotate('text',x=2650,y=-30,label="Curry, KD Out",angle=90,hjust=0)
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2700) +
annotate('text',x=2650,y=-10,label="Curry, KD Out",angle=90,hjust=0)
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2700) +
annotate('text',x=2650,y=-20,label="Curry, KD Out",angle=90,hjust=0)
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1650,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2700) +
annotate('text',x=2650,y=-17,label="Curry, KD Out",angle=90,hjust=0)
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1640,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2700) +
annotate('text',x=2650,y=-17,label="Curry, KD Out",angle=90,hjust=0)
12-3
9_60
9*60 34
9*60 + 34
720*3 + 9*60 + 34
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0)
get_single_game_stats(2019,"201812250GSW")
get_single_game_stats(2019,"201812250BOS")
source("scripts/analyze_play_by_play.R")
# in games where x team is down 5 going into the third quarter, how often win?
season <- read.csv("data/schedules/NBA-2018_schedule.csv",stringsAsFactors = F)
teams <- unique(season$home_team_name)
get_winrate_for_3q_down <-  function(season, period_in, team){
# season <- 2018;team= "Brooklyn Nets";period_in=3;threshold=-10
team_pbp <- get_team_shot_x_time(season, team)
game_by_period <- team_pbp %>%
group_by(game_id,period) %>%
summarise(starting=first(cum_adv),
ending=last(cum_adv)) %>%
as.data.frame()
game_by_period <- game_by_period %>%
group_by(game_id) %>%
mutate(win = last(ending>0,T,F))
third_p_down <- game_by_period %>%
filter(period == period_in) %>%
filter(starting > 10)
# get win rate
win_pct <- prop.table(table(third_p_down$win)) %>%
as.data.frame() %>%
filter(Var1==T) %>%
pull(Freq)
if(length(win_pct)==0){win_pct<-0}
# get decrease in score for quarter
change_in_period <- third_p_down %>%
mutate(change = ending - starting) %>%
pull(change) %>%
median()
return(data.frame(team,
win_pct,
change_in_period,
stringsAsFactors = F))
# rm(season);rm(team);rm(period_in);rm(threshold)
}
# get win rates
stats <- lapply(teams,
function(x){
stats =  winrate=get_winrate_for_3q_down(season=2018,period_in=3,team=x)
print(stats)
return(stats)
}
) %>% do.call('rbind',.)
# chance of winning game
ggplot(stats, aes(y=reorder(team,win_pct),x=win_pct)) +
geom_lollipop(horizontal = T,size=1)
# change in score in x quarter
ggplot(stats, aes(y=reorder(team,change_in_period),x=change_in_period)) +
geom_lollipop(horizontal = T,size=1)
gg1
gg2
# chance of winning game
ggplot(stats, aes(y=reorder(team,win_pct),x=win_pct)) +
geom_lollipop(horizontal = T,size=1)
source("scripts/analyze_play_by_play.R")
# in games where x team is down 5 going into the third quarter, how often win?
season <- read.csv("data/schedules/NBA-2018_schedule.csv",stringsAsFactors = F)
teams <- unique(season$home_team_name)
get_winrate_for_3q_down <-  function(season, period_in, team){
# season <- 2018;team= "Brooklyn Nets";period_in=3;threshold=-10
team_pbp <- get_team_shot_x_time(season, team)
game_by_period <- team_pbp %>%
group_by(game_id,period) %>%
summarise(starting=first(cum_adv),
ending=last(cum_adv)) %>%
as.data.frame()
game_by_period <- game_by_period %>%
group_by(game_id) %>%
mutate(win = last(ending>0,T,F))
third_p_down <- game_by_period %>%
filter(period == period_in) %>%
filter(starting < 100)
# get win rate
win_pct <- prop.table(table(third_p_down$win)) %>%
as.data.frame() %>%
filter(Var1==T) %>%
pull(Freq)
if(length(win_pct)==0){win_pct<-0}
# get decrease in score for quarter
change_in_period <- third_p_down %>%
mutate(change = ending - starting) %>%
pull(change) %>%
median()
return(data.frame(team,
win_pct,
change_in_period,
stringsAsFactors = F))
# rm(season);rm(team);rm(period_in);rm(threshold)
}
# get win rates
stats <- lapply(teams,
function(x){
stats =  winrate=get_winrate_for_3q_down(season=2018,period_in=3,team=x)
print(stats)
return(stats)
}
) %>% do.call('rbind',.)
# chance of winning game
ggplot(stats, aes(y=reorder(team,win_pct),x=win_pct)) +
geom_lollipop(horizontal = T,size=1)
# change in score in x quarter
ggplot(stats, aes(y=reorder(team,change_in_period),x=change_in_period)) +
geom_lollipop(horizontal = T,size=1)
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250BOS")
get_single_game_stats(2019,"201812250GSW")
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0)
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0)
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250GSW")
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0)
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250GSW")
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0)
get_single_game_stats(2019,"201812250BOS")
get_single_game_stats(2019,"201812250GSW")
gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0)
preview(gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0))
# change in score in x quarter
ggplot(stats, aes(y=reorder(team,change_in_period),x=change_in_period)) +
geom_lollipop(horizontal = T,size=1)
# change in score in x quarter
preview(
ggplot(stats, aes(y=reorder(team,change_in_period),x=change_in_period)) +
geom_lollipop(horizontal = T,size=1) +
labs(x="Net Change in Pts Adv, Third Quarter",
y= "Team")
)
# get win rates
stats <- lapply(teams,
function(x){
stats =  winrate=get_winrate_for_3q_down(season=2018,period_in=4,team=x)
print(stats)
return(stats)
}
) %>% do.call('rbind',.)
# chance of winning game
ggplot(stats, aes(y=reorder(team,win_pct),x=win_pct)) +
geom_lollipop(horizontal = T,size=1)
# change in score in x quarter
preview(
ggplot(stats, aes(y=reorder(team,change_in_period),x=change_in_period)) +
geom_lollipop(horizontal = T,size=1) +
labs(x="Net Change in Pts Adv, Fourth Quarter",
y= "Team")
)
get_single_game_stats(2019,"201812250GSW")
pbp_df
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250GSW")
# change in score in x quarter
preview(
ggplot(stats, aes(y=reorder(team,change_in_period),x=change_in_period)) +
geom_lollipop(horizontal = T,size=1) +
labs(x="Net Change in Pts Adv, Fourth Quarter",
y= "Team")
)
source("scripts/analyze_play_by_play.R")
# in games where x team is down 5 going into the third quarter, how often win?
season <- read.csv("data/schedules/NBA-2018_schedule.csv",stringsAsFactors = F)
teams <- unique(season$home_team_name)
get_winrate_for_3q_down <-  function(season, period_in, team){
# season <- 2018;team= "Brooklyn Nets";period_in=3;threshold=-10
team_pbp <- get_team_shot_x_time(season, team)
game_by_period <- team_pbp %>%
group_by(game_id,period) %>%
summarise(starting=first(cum_adv),
ending=last(cum_adv)) %>%
as.data.frame()
game_by_period <- game_by_period %>%
group_by(game_id) %>%
mutate(win = last(ending>0,T,F))
third_p_down <- game_by_period %>%
filter(period == period_in) %>%
filter(starting < 100)
# get win rate
win_pct <- prop.table(table(third_p_down$win)) %>%
as.data.frame() %>%
filter(Var1==T) %>%
pull(Freq)
if(length(win_pct)==0){win_pct<-0}
# get decrease in score for quarter
change_in_period <- third_p_down %>%
mutate(change = ending - starting) %>%
pull(change) %>%
median()
return(data.frame(team,
win_pct,
change_in_period,
stringsAsFactors = F))
# rm(season);rm(team);rm(period_in);rm(threshold)
}
# get win rates
stats <- lapply(teams,
function(x){
stats =  winrate=get_winrate_for_3q_down(season=2018,period_in=4,team=x)
print(stats)
return(stats)
}
) %>% do.call('rbind',.)
source("scripts/analyze_play_by_play.R")
# in games where x team is down 5 going into the third quarter, how often win?
season <- read.csv("data/schedules/NBA-2018_schedule.csv",stringsAsFactors = F)
teams <- unique(season$home_team_name)
get_winrate_for_3q_down <-  function(season, period_in, team){
# season <- 2018;team= "Brooklyn Nets";period_in=3;threshold=-10
team_pbp <- get_team_shot_x_time(season, team)
game_by_period <- team_pbp %>%
group_by(game_id,period) %>%
summarise(starting=first(cum_adv),
ending=last(cum_adv)) %>%
as.data.frame()
game_by_period <- game_by_period %>%
group_by(game_id) %>%
mutate(win = last(ending>0,T,F))
third_p_down <- game_by_period %>%
filter(period == period_in) %>%
filter(starting < 100)
# get win rate
win_pct <- prop.table(table(third_p_down$win)) %>%
as.data.frame() %>%
filter(Var1==T) %>%
pull(Freq)
if(length(win_pct)==0){win_pct<-0}
# get decrease in score for quarter
change_in_period <- third_p_down %>%
mutate(change = ending - starting) %>%
pull(change) %>%
median()
return(data.frame(team,
win_pct,
change_in_period,
stringsAsFactors = F))
# rm(season);rm(team);rm(period_in);rm(threshold)
}
# get win rates
stats <- lapply(teams,
function(x){
stats =  winrate=get_winrate_for_3q_down(season=2018,period_in=3,team=x)
print(stats)
return(stats)
}
) %>% do.call('rbind',.)
# chance of winning game
ggplot(stats, aes(y=reorder(team,win_pct),x=win_pct)) +
geom_lollipop(horizontal = T,size=1)
# change in score in x quarter
preview(
ggplot(stats, aes(y=reorder(team,change_in_period),x=change_in_period)) +
geom_lollipop(horizontal = T,size=1) +
labs(x="Median Net Change in Pts Adv, Third Quarter",
y= "Team")
)
source("scripts/analyze_play_by_play.R")
get_single_game_stats(2019,"201812250GSW")
preview(gg + geom_vline(xintercept = 1690) +
annotate('text',x=1690-50,y=-30,label="LeBron Out",angle=90,hjust=0) + geom_vline(xintercept = 2734) +
annotate('text',x=2734-50,y=-17,label="Curry, KD Out",angle=90,hjust=0))
